openapi: 3.0.0
info:
  title: Book-Side RAG Chatbot API
  description: API for the RAG chatbot integrated with the Physical AI & Humanoid Robotics book
  version: 1.0.0
paths:
  /query:
    post:
      summary: Submit a query about the book content
      description: Submit a question about the book content and receive a response based on the full book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserQuery'
      responses:
        '200':
          description: Successful response with answer to the query
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '400':
          description: Invalid query format
        '500':
          description: Internal server error during query processing
  /query-selected:
    post:
      summary: Submit a query with selected text context
      description: Submit a question with selected text as additional context
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  $ref: '#/components/schemas/UserQuery'
                selectedText:
                  type: string
                  description: Text selected by the user from the book content
                  example: "The principles of humanoid robotics involve complex control systems..."
              required:
                - query
                - selectedText
      responses:
        '200':
          description: Successful response with answer to the query based on selected text
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '400':
          description: Invalid query or selected text format
        '500':
          description: Internal server error during query processing
components:
  schemas:
    UserQuery:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the query
          example: "query-123"
        content:
          type: string
          description: The actual question text
          example: "Explain the control systems used in humanoid robotics"
        timestamp:
          type: string
          format: date-time
          description: When the query was submitted
        userId:
          type: string
          description: Identifier for the user, if available
          example: "user-456"
        sessionId:
          type: string
          description: To group related queries
          example: "session-789"
      required:
        - content
    ChatResponse:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the response
          example: "response-101"
        content:
          type: string
          description: The actual response text
          example: "Humanoid robotics control systems typically involve..."
        timestamp:
          type: string
          format: date-time
          description: When the response was generated
        queryId:
          type: string
          description: Reference to the original query
          example: "query-123"
        sourceBookContentIds:
          type: array
          items:
            type: string
          description: IDs of book content used to generate response
          example: ["chapter-3", "section-3.2"]
        confidence:
          type: number
          format: float
          description: Confidence score of the response (0-1)
          minimum: 0
          maximum: 1
          example: 0.85
        citations:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
                description: Title of the cited content
              url:
                type: string
                description: URL to the cited content
          description: References to specific parts of book content
      required:
        - content
        - queryId